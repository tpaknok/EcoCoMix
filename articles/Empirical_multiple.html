<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Empirical Analyses with CPR - Multiple Functions • CPR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Empirical Analyses with CPR - Multiple Functions">
<script defer data-domain="tpaknok.github.io/CPR,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">CPR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Advanced_uses.html">Complex models and manual priors</a></li>
    <li><a class="dropdown-item" href="../articles/Empirical_multiple.html">Empirical Analyses with CPR - Multiple Functions</a></li>
    <li><a class="dropdown-item" href="../articles/Empirical_single.html">Empirical Analyses with CPR - Single Function</a></li>
    <li><a class="dropdown-item" href="../articles/Simulation.html">Simulation with CPR</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tpaknok/CPR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Empirical Analyses with CPR - Multiple Functions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tpaknok/CPR/blob/main/vignettes/Empirical_multiple.Rmd" class="external-link"><code>vignettes/Empirical_multiple.Rmd</code></a></small>
      <div class="d-none name"><code>Empirical_multiple.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Assuming that you have multiple ecosystem functions to analyse, you
can repeat the code for single ecosystem function analyses multiple
times. This is a bit annoying though, especially if you have a lot of
data! Here, I will provide an example on how to use a loop to do it.</p>
<p>First, load the data again.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/liamrevell/phytools" class="external-link">phytools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tpaknok/CPR" class="external-link">CPR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"KSR"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"KSR_MLtree"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"KSR_EF"</span><span class="op">)</span></span>
<span><span class="va">VCV_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/vcv.phylo.html" class="external-link">vcv</a></span><span class="op">(</span><span class="va">KSR_MLtree</span><span class="op">)</span> <span class="co">#species level phyologenetic covariance matrix using default (Brownian) model</span></span>
<span><span class="va">VCV_sp</span> <span class="op">&lt;-</span> <span class="va">VCV_sp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">VCV_sp</span><span class="op">)</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">VCV_sp</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">VCV_comm</span> <span class="op">&lt;-</span> <span class="fu">get_comm_pair_r</span><span class="op">(</span><span class="va">KSR</span>,<span class="va">VCV_sp</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-explorations">Data Explorations<a class="anchor" aria-label="anchor" href="#data-explorations"></a>
</h2>
<p>We will use lapply to do it. We have ten ecosystem functions, and
they have very different statistical properties. For examples, arthropod
abundance must be integer, while damage reduction effects are
continuous. If you visualize the distributions of different ecosystem
functions, you can see that some of them have a spike in zero!</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">KSR_EF</span><span class="op">$</span><span class="va">LAI</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure%2FLAI-1.png" alt="Histograms of LAI" width="100%"><p class="caption">
Histograms of LAI
</p>
</div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">KSR_EF</span><span class="op">$</span><span class="va">flwr_total</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure%2Fflwr%20total-1.png" alt="Histograms of floral abundance" width="100%"><p class="caption">
Histograms of floral abundance
</p>
</div>
<p>Thus, we will use different distributions for different ecosystem
functions. For example, we will use negative binomial for integer data,
and zeroinflated negative binomial for integer data that have many
zeros. For continuous data, we can use normal distribution, or tweedie
distribution if we have too many zeroes.</p>
<p>We need to create lists to store different formulas, the name of
distribution, and the priors for different models. Let’s do it here.</p>
<p>inla.set.contro.family.default indicates we will use the default
priors for the hyperparameters. However, for tweedie distribution, we
specified our own non-informative prior.</p>
</div>
<div class="section level2">
<h2 id="model-setups">Model Setups<a class="anchor" aria-label="anchor" href="#model-setups"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"poll_total"</span>,</span>
<span>       <span class="st">"bugs"</span>,</span>
<span>       <span class="st">"bug.rich"</span>,</span>
<span>       <span class="st">"litter2012"</span>,</span>
<span>       <span class="st">"ave.biomass"</span>,</span>
<span>       <span class="st">"flwr_total"</span>,</span>
<span>       <span class="st">"Mass.loss.2month"</span>,</span>
<span>       <span class="st">"LAI"</span>,</span>
<span>       <span class="st">"mean.N.change"</span>,</span>
<span>       <span class="st">"Damage_effect"</span><span class="op">)</span> <span class="co">#response</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"Real.rich"</span> <span class="co"># predictors</span></span>
<span><span class="va">re</span> <span class="op">&lt;-</span> <span class="st">'f(comm,model="generic0",Cmatrix=Phylo)'</span> <span class="co">#random effect</span></span>
<span></span>
<span><span class="va">family</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"zeroinflatednbinomial1"</span>,</span>
<span>            <span class="st">"nbinomial"</span>,</span>
<span>            <span class="st">"nbinomial"</span>,</span>
<span>            <span class="st">"gaussian"</span>,</span>
<span>            <span class="st">"gaussian"</span>,</span>
<span>            <span class="st">"tweedie"</span>,</span>
<span>            <span class="st">"gaussian"</span>,</span>
<span>            <span class="st">"gaussian"</span>,</span>
<span>            <span class="st">"gaussian"</span>,</span>
<span>            <span class="st">"gaussian"</span><span class="op">)</span> <span class="co">#family for each response</span></span>
<span></span>
<span><span class="va">formulas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">y</span>,<span class="st">"~"</span>,<span class="va">x</span>,<span class="st">"+"</span>,<span class="va">re</span><span class="op">)</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/formula.html" class="external-link">as.formula</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">control.family</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/INLA/man/control.family.html" class="external-link">inla.set.control.family.default</a></span><span class="op">(</span><span class="st">"zeroinflatednbinomial1"</span><span class="op">)</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/control.family.html" class="external-link">inla.set.control.family.default</a></span><span class="op">(</span><span class="st">"nbinomial"</span><span class="op">)</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/control.family.html" class="external-link">inla.set.control.family.default</a></span><span class="op">(</span><span class="st">"nbinomial"</span><span class="op">)</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/control.family.html" class="external-link">inla.set.control.family.default</a></span><span class="op">(</span><span class="st">"gaussian"</span><span class="op">)</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/control.family.html" class="external-link">inla.set.control.family.default</a></span><span class="op">(</span><span class="st">"gaussian"</span><span class="op">)</span>,</span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>                         theta1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>initial <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>                         theta2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>initial <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                       prior <span class="op">=</span> <span class="st">"loggamma"</span>,</span>
<span>                                       param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/control.family.html" class="external-link">inla.set.control.family.default</a></span><span class="op">(</span><span class="st">"gaussian"</span><span class="op">)</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/control.family.html" class="external-link">inla.set.control.family.default</a></span><span class="op">(</span><span class="st">"gaussian"</span><span class="op">)</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/control.family.html" class="external-link">inla.set.control.family.default</a></span><span class="op">(</span><span class="st">"gaussian"</span><span class="op">)</span>,</span>
<span>                      <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/control.family.html" class="external-link">inla.set.control.family.default</a></span><span class="op">(</span><span class="st">"gaussian"</span><span class="op">)</span><span class="op">)</span> <span class="co">#hyperparameter priors</span></span>
<span></span>
<span><span class="va">KSR_EF_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">KSR_EF</span><span class="op">)</span> <span class="co">#create ten sets of KSR_EF data</span></span>
<span><span class="va">comm_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">KSR</span><span class="op">)</span> <span class="co">#ten sets of comm data</span></span>
<span></span>
<span><span class="va">KSR_EF_list</span><span class="op">[[</span><span class="fl">10</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">KSR_EF_list</span><span class="op">[[</span><span class="fl">10</span><span class="op">]</span><span class="op">]</span>, <span class="va">Real.rich</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span> <span class="co">#for damage effect, we exclude monoculture communities</span></span>
<span><span class="va">comm_list</span><span class="op">[[</span><span class="fl">10</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">KSR</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">KSR</span><span class="op">)</span> <span class="op">&gt;</span><span class="fl">1</span>,<span class="op">]</span> <span class="co">#for damage effect, we exclude monoculture communities</span></span></code></pre></div>
<p>Then we can simply use lapply to do loop through everything. This
will take some time to run!!!</p>
</div>
<div class="section level2">
<h2 id="empirical-analyses---multiple-functions">Empirical Analyses - Multiple Functions<a class="anchor" aria-label="anchor" href="#empirical-analyses---multiple-functions"></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">BEF_KSR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/CPR.html">CPR</a></span><span class="op">(</span><span class="va">formulas</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                                    priors<span class="op">=</span><span class="cn">NULL</span>,</span>
<span>                                                    df <span class="op">=</span> <span class="va">KSR_EF_list</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                                    VCV_sp <span class="op">=</span> <span class="va">VCV_sp</span>,</span>
<span>                                                    comm<span class="op">=</span><span class="va">comm_list</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                                    family<span class="op">=</span><span class="va">family</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                                    control.family<span class="op">=</span><span class="va">control.family</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span>,</span>
<span>                                                    inla.rerun<span class="op">=</span><span class="fl">3</span>,</span>
<span>                                                    optim.lambda <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="visualizations">Visualizations<a class="anchor" aria-label="anchor" href="#visualizations"></a>
</h2>
<p>To visualize the expected effect of species richness on different
ecosystem functions, we need to extract the predictions from each
model.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_predictions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>,<span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">BEF_KSR</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">prediction</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>To make a figure, I also need to restructure KSR_EF from a wide
format to long format. Also, flower abundance ranged from 0-60000, so I
presented the findings in log-scale (although in the analyses we did not
log transform it, as tweedie use log link).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="va">KSR_EF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">any_of</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">|</span><span class="st">"Real.rich"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="op">!</span><span class="va">Real.rich</span>,names_to<span class="op">=</span><span class="st">"response"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_data</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">plot_data</span><span class="op">$</span><span class="va">response</span> <span class="op">==</span> <span class="st">"flwr_total"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">$</span><span class="va">value</span><span class="op">[</span><span class="va">plot_data</span><span class="op">$</span><span class="va">response</span> <span class="op">==</span> <span class="st">"flwr_total"</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">all_predictions</span><span class="op">[</span><span class="va">all_predictions</span><span class="op">$</span><span class="va">response</span> <span class="op">==</span> <span class="st">"flwr_total"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0.5quant"</span>,<span class="st">"0.025quant"</span>,<span class="st">"0.975quant"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">all_predictions</span><span class="op">[</span><span class="va">all_predictions</span><span class="op">$</span><span class="va">response</span> <span class="op">==</span> <span class="st">"flwr_total"</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0.5quant"</span>,<span class="st">"0.025quant"</span>,<span class="st">"0.975quant"</span><span class="op">)</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Now just some ggplot2 code, and this is how the figure in Tsang et
al. (2024) was produced.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">all_predictions</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">plot_data</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">value</span>,x<span class="op">=</span><span class="va">Real.rich</span><span class="op">)</span>,width<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">`0.5quant`</span>,x<span class="op">=</span><span class="va">Real.rich</span>,colour<span class="op">=</span><span class="va">model</span>,linetype<span class="op">=</span><span class="va">Sig</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">`0.5quant`</span>,x<span class="op">=</span><span class="va">Real.rich</span>,fill<span class="op">=</span><span class="va">model</span>,ymin<span class="op">=</span><span class="va">`0.025quant`</span>,ymax<span class="op">=</span><span class="va">`0.975quant`</span><span class="op">)</span>,alpha<span class="op">=</span><span class="fl">0.3</span>,colour<span class="op">=</span><span class="st">"transparent"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">response</span>,scales<span class="op">=</span><span class="st">"free"</span>,nrow<span class="op">=</span><span class="fl">5</span>,ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"Species richness"</span>,y<span class="op">=</span><span class="st">"Ecosystem function"</span>,colour<span class="op">=</span><span class="st">"Model"</span>,fill<span class="op">=</span><span class="st">"Model"</span>,linetype<span class="op">=</span><span class="st">"Significance"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_linetype_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#000000"</span>,<span class="st">"#E69F00"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"#000000"</span>,<span class="st">"#E69F00"</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"bottom"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure%2Fggplot2%2C%20-1.png" alt="Predicted effects of species richness on the ten selected ecosystem functions" width="100%"><p class="caption">
Predicted effects of species richness on the ten selected ecosystem
functions
</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by Toby Pak Nok Tsang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
