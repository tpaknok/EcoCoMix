<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Provide marginal and conditional R-squared for outputs from spaMM — get_R2 • EcoCoMix</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Provide marginal and conditional R-squared for outputs from spaMM — get_R2"><meta name="description" content="Provide marginal and conditional R-squared for outputs from spaMM"><meta property="og:description" content="Provide marginal and conditional R-squared for outputs from spaMM"><meta property="og:image" content="https://tpaknok.github.io/CPR/logo.png"><script defer data-domain="tpaknok.github.io/CPR,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">EcoCoMix</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/tpaknok/CPR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Provide marginal and conditional R-squared for outputs from spaMM</h1>

      <div class="d-none name"><code>get_R2.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Provide marginal and conditional R-squared for outputs from spaMM</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">get_R2</span><span class="op">(</span><span class="va">spaMM_m</span>,spaMM_m_int_only<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-spamm-m">spaMM_m<a class="anchor" aria-label="anchor" href="#arg-spamm-m"></a></dt>
<dd><p>model output from spaMM</p></dd>

  <dt id="arg-spamm-m-int-only">spaMM_m_int_only<a class="anchor" aria-label="anchor" href="#arg-spamm-m-int-only"></a></dt>
<dd><p>intercept-only model from spaMM. Only needed for negative binomial distribution.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function is based on <code>R2</code> from the performance package, which does not support spaMM. Note that the model currently only supports gassuian and negative binomial (negbin2) distribution. If the model doesn't contain any compositional autocorrelation, it's probably easier to use other packages or functions (e.g. lme4, glmmTMB, lm, glm), which is better supported by other R packages.</p>
<p>You can also calculate the correlation coefficient between observed and predicted responses (prediction can be based on fixed effects only or full model, depending on the purposes). This is technically not the same as marginal and conditional R-squared, but should be a easy solution if you have models based on distributions not supported here.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p></p>
<dl><dt>R2m</dt>
<dd><p>Marginal R-squared.</p></dd>

  <dt>R2c</dt>
<dd><p>Conditional R-squared.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Toby P.N. Tsang</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code>R2</code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/liamrevell/phytools" class="external-link">phytools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tpaknok/EcoCoMix" class="external-link">EcoCoMix</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/emmanuelparadis/ape" class="external-link">ape</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://florianhartig.github.io/DHARMa/" class="external-link">DHARMa</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">KSR</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">KSR_MLtree</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">KSR_EF</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### Normal distribution</span></span>
<span><span class="va">m_LAI</span> <span class="op">&lt;-</span> <span class="fu"><a href="EcoCoMix.html">EcoCoMix</a></span><span class="op">(</span><span class="va">LAI</span><span class="op">~</span><span class="va">Real.rich</span><span class="op">+</span><span class="fu">corrMatrix</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">comp_id</span><span class="op">)</span>,</span>
<span>                   data<span class="op">=</span><span class="va">KSR_EF</span>,</span>
<span>                   comm<span class="op">=</span><span class="va">KSR</span>,</span>
<span>                   VCV_sp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/vcv.phylo.html" class="external-link">vcv</a></span><span class="op">(</span><span class="va">KSR_MLtree</span><span class="op">)</span>,</span>
<span>                   method.spaMM<span class="op">=</span><span class="st">"REML"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">get_R2</span><span class="op">(</span><span class="va">m_LAI</span><span class="op">$</span><span class="va">best_model</span><span class="op">)</span> <span class="co">#get R2 for best model</span></span>
<span><span class="fu">get_R2</span><span class="op">(</span><span class="va">m_LAI</span><span class="op">$</span><span class="va">original_VCV_model</span><span class="op">)</span> <span class="co">#get R2 for model based on the provided phylogenetic covariance matrix between species</span></span>
<span></span>
<span><span class="co">### nbinom2</span></span>
<span><span class="va">m_bugs</span> <span class="op">&lt;-</span> <span class="fu"><a href="EcoCoMix.html">EcoCoMix</a></span><span class="op">(</span><span class="va">bugs</span><span class="op">~</span><span class="va">Real.rich</span><span class="op">+</span><span class="fu">corrMatrix</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">comp_id</span><span class="op">)</span>,</span>
<span>                   data<span class="op">=</span><span class="va">KSR_EF</span>,</span>
<span>                   comm<span class="op">=</span><span class="va">KSR</span>,</span>
<span>                   VCV_sp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/vcv.phylo.html" class="external-link">vcv</a></span><span class="op">(</span><span class="va">KSR_MLtree</span><span class="op">)</span>,</span>
<span>                   family<span class="op">=</span><span class="st">"negbin2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># for the full model with lambda = 1</span></span>
<span><span class="co"># obtain phylogenetic correlation matrix at the community level</span></span>
<span><span class="va">KSR_EF</span><span class="op">$</span><span class="va">comp_id</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">KSR_EF</span><span class="op">)</span></span>
<span><span class="va">phy_comm_M</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_comm_pair_r.html">get_comm_pair_r</a></span><span class="op">(</span><span class="va">KSR</span>,<span class="fu"><a href="https://rdrr.io/pkg/ape/man/vcv.phylo.html" class="external-link">vcv</a></span><span class="op">(</span><span class="va">KSR_MLtree</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">corM</span></span>
<span></span>
<span><span class="va">m_bugs_int</span> <span class="op">&lt;-</span> <span class="fu">fitme</span><span class="op">(</span><span class="va">bugs</span><span class="op">~</span><span class="fl">1</span><span class="op">+</span><span class="fu">corrMatrix</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">comp_id</span><span class="op">)</span>,corrMatrix<span class="op">=</span><span class="fu">as_precision</span><span class="op">(</span><span class="va">phy_comm_M</span><span class="op">)</span>,data<span class="op">=</span><span class="va">KSR_EF</span>,family<span class="op">=</span><span class="st">"negbin2"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">get_R2</span><span class="op">(</span><span class="va">m_bugs</span><span class="op">$</span><span class="va">original_VCV_model</span>,<span class="va">m_bugs_int</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># for the full model with optimized lambda (also the best model in this case)</span></span>
<span></span>
<span><span class="co"># modify the species level phylogenetic covariance matrix based on the optimized lambda</span></span>
<span><span class="va">optim_VCV_sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/vcv.phylo.html" class="external-link">vcv</a></span><span class="op">(</span><span class="va">KSR_MLtree</span><span class="op">)</span><span class="op">*</span><span class="va">m_LAI</span><span class="op">$</span><span class="va">optimized_lambda</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">optim_VCV_sp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/vcv.phylo.html" class="external-link">vcv</a></span><span class="op">(</span><span class="va">KSR_MLtree</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># obtain phylogenetic correlation matrix at the community level</span></span>
<span><span class="va">phy_comm_M</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_comm_pair_r.html">get_comm_pair_r</a></span><span class="op">(</span><span class="va">KSR</span>,<span class="va">optim_VCV_sp</span><span class="op">)</span><span class="op">$</span><span class="va">corM</span></span>
<span></span>
<span><span class="va">m_bugs_int</span> <span class="op">&lt;-</span> <span class="fu">fitme</span><span class="op">(</span><span class="va">bugs</span><span class="op">~</span><span class="fl">1</span><span class="op">+</span><span class="fu">corrMatrix</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">comp_id</span><span class="op">)</span>,corrMatrix<span class="op">=</span><span class="fu">as_precision</span><span class="op">(</span><span class="va">phy_comm_M</span><span class="op">)</span>,data<span class="op">=</span><span class="va">KSR_EF</span>,family<span class="op">=</span><span class="st">"negbin2"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">get_R2</span><span class="op">(</span><span class="va">m_bugs</span><span class="op">$</span><span class="va">best_model</span>,<span class="va">m_bugs_int</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### best model without random effect</span></span>
<span><span class="va">m_litter</span> <span class="op">&lt;-</span> <span class="fu"><a href="EcoCoMix.html">EcoCoMix</a></span><span class="op">(</span><span class="va">litter2012</span><span class="op">~</span><span class="va">Real.rich</span><span class="op">+</span><span class="fu">corrMatrix</span><span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">comp_id</span><span class="op">)</span>,</span>
<span>                   data<span class="op">=</span><span class="va">KSR_EF</span>,</span>
<span>                   comm<span class="op">=</span><span class="va">KSR</span>,</span>
<span>                   VCV_sp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/ape/man/vcv.phylo.html" class="external-link">vcv</a></span><span class="op">(</span><span class="va">KSR_MLtree</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m_litter_best</span> <span class="op">&lt;-</span> <span class="fu">fitme</span><span class="op">(</span><span class="va">litter2012</span><span class="op">~</span><span class="va">Real.rich</span>,data<span class="op">=</span><span class="va">KSR_EF</span><span class="op">)</span> <span class="co">#fitme approach</span></span>
<span><span class="fu">pseudoR2</span><span class="op">(</span><span class="va">m_litter_best</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m_litter_best2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">litter2012</span><span class="op">~</span><span class="va">Real.rich</span>,data<span class="op">=</span><span class="va">KSR_EF</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">m_litter_best2</span><span class="op">)</span> <span class="co">#same result</span></span></code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by Toby Pak Nok Tsang.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer></body></html>

